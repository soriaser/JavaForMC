\section{Code Analysis}\label{S:Res:Code}
\input{Chapters/Resistive/FiniteStateMachine}
\input{Chapters/Resistive/TimersAndCaptureMode}
\subsection{Analysis}\label{SS:Res:Code:Analysis}
As explained during introduction of this report, PIC18F4520 microcontroller has been used to analyze circuits from Figures \ref{fig:MicrocontrollerBasedInterfaceCircuitResistor2Points} and \ref{fig:MicrocontrollerBasedInterfaceCircuitResistor3Points}. As explained during Section \ref{S:Res:Analysis}, they are based on charge and discharge of RC circuit.
\medskip

Taken into account a RC circuit connected to a microcontroller pin, following states can be configured on this pin in order to either charge, discharge the capacitor $C$ or set as high-impedance input (HZ\nomenclature{HZ}{High-Impedance}). Those states can be set up modifying TRIS and PORT registers of corresponding pin port bits as defined in Table \ref{tab:PinConfigurations}.
\medskip

\begin{table}[h]
\centering
\begin{tabular}{|c|c|c|}
\hline
Pin Configuration & TRIS bit register value & PORT bit register value \\
\hline
Charge & 0 & 1 \\
\hline
Discharge & 0 & 0 \\
\hline
High-Impedance & 1 & - \\
\hline
\end{tabular}
\caption{Microcontroller pin configuration}
\label{tab:PinConfigurations}
\end{table}
\medskip

In Figures \ref{fig:MicrocontrollerBasedInterfaceCircuitResistor2Points} and \ref{fig:MicrocontrollerBasedInterfaceCircuitResistor3Points}, microcontroller pins connected to $R_{x}$, $R_{c1}$ and $R_{c2}$ should be configured as defined in Table \ref{tab:DischargePinConfigurationsRes} during capacitor discharge. Capacitor charge is performed configuring Pin 4 as Charge and Pin 1, Pin 2 and Pin 3 as High-Impedance.
\medskip

\begin{table}[h]
\centering
\begin{tabular}{|c|c|c|c|}
\hline
$N$ result & Pin 1 & Pin 2 & Pin 3 \\
\hline
$N_{x}$ & HZ & HZ & Discharge \\
\hline
$N_{c1}$ & HZ & Discharge & HZ \\
\hline
$N_{c2}$ & Discharge & HZ & HZ \\
\hline
\end{tabular}
\caption{Pin configurations during discharging time on resistive sensor system}
\label{tab:DischargePinConfigurationsRes}
\end{table}
\medskip

Pin 4 is also set to HZ during discharging process and it is configured as interruption when rising edge is detected on its port pin. It is configured on rising edge instead of falling edge (capacitor discharge) because an external Schmitt trigger is connected to Pin 4, then signal is inverted.
\medskip

Figure \ref{fig:ResistorsCodeDiagram} shows a diagram explaining the programming code of application loaded into PIC18F5420 microcontroller.
\medskip

\begin{figure}[!ht]
\centering
\includegraphics[scale=0.5]{ResistorsCodeDiagram.eps}
\caption{Code diagram of application to measure resistor sensor}
\label{fig:ResistorsCodeDiagram}
\end{figure}

\colorbox{yellow}{Añadir explicación detallada del diagrama de bloques!!}
\subsection{Native}\label{SS:Res:Code:Native}
\subsection{Java}\label{SS:Res:Code:Java}